<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<link rel="stylesheet" type="text/css" href="css/simplegrid.css">
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/dimple/2.3.0/dimple.latest.js"></script>
		<script type="text/javascript">
						
			function plotDiagrams() {
				
				var barSvg = dimple.newSvg("#bar", 590, 400);
				var areaSvg = dimple.newSvg("#area", 590, 400);
				d3.csv('data/total.csv', function(total) {
					d3.csv('data/causes.csv', function(causes) {
						//console.log('1');
						var barChart = new dimple.chart(barSvg, total);
						barChart.setBounds(60, 30, 510, 305)
						
						var x = barChart.addCategoryAxis("x", "Airport")
						x.addOrderRule("Airport")
												
						barChart.addMeasureAxis("y", "Delays (%)");
						var s = barChart.addSeries('Cause', dimple.plot.bar);
						barChart.addLegend(60, 10, 510, 60, "center");
						
						s.addEventHandler("click", function(e) {
							filtered = dimple.filterData(causes, "Airport", e.xValue);
							areaChart.data = filtered;
							document.getElementById("airport").innerHTML = e.xValue + " - Delays over time.";
							areaChart.draw(1000);
						});
						
						barChart.draw();
						
						data = causes;
						var areaChart = new dimple.chart(areaSvg, data);
						areaChart.setBounds(60, 30, 510, 305);
						var x = areaChart.addCategoryAxis("x", "Year");
						x.addOrderRule("Year");
						areaChart.addMeasureAxis("y", "Delays (%)");
						var j = areaChart.addSeries("Cause", dimple.plot.area);
						areaChart.addLegend(60, 10, 410, 60, "right");
						areaChart.draw();
					})
				})
			};
								
		</script>
	</head>
	<body>
		<div class="grid">
			<div class="col-1-1">
				<div class="title">
					Delays across major US airports
				</div>
			</div>
			<div class="col-1-1">
				<div class="title">
					<br />
				</div>
			</div>
			<div class="col-1-2">
				<div class="col-1-1">
					<div class="content">
						<chart_title>
							Average delays for the period June 2003 - February 2017
							<br />
						</chart_title>
						(Select an airport to see delays over time)
					</div>
				</div>
				<div class="col-1-1">
					<div id='bar'></div>
				</div>
				
			</div>
			<div class="col-1-2">
				<div class="col-1-1">
					<div class="chart_title" id="airport">
						ATL - Delays over time
					</div>
				</div>
				<div class="col-1-1">
					<br />
				</div>
				<div class="col-1-1">
					<div id='area'>
						<script type="text/javascript">
							plotDiagrams();
						</script>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>